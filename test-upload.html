<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Test Image Upload</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>

      .upload-form {
        border: 1px solid black;
        width: 600px;
        margin: 100px auto 0 auto;
      }

    </style>    
  </head>

  <body>

    <form id='upload-form' class='upload-form'>

      <label>
        Title<br />
        <input id='media-upload-title' type='text' name='title' />
      </label>

      <br /><br />

      <label>
        Description<br />
        <input id='media-upload-description' type='text' name='description' />
      </label>

      <br /><br />

      <label>
        Select an image<br />
        <input id='media-upload-input' type="file" name="media"><br />
      </label>

      <br /><br />

      <button id='upload-form-submit-button' type='submit'>Submit</button>
    </form>

    <script type='text/javascript'>

      // Register the user and get the token.
      const register = (display_name, email, password) => {

        const user = { display_name, email, password };

        axios.post('http://localhost:4000/users/register/email', user)
          .then(registerRes => {

            const { user_id, token } = loginRes.data;

            // Store token and user id in local storage.
            localStorage.setItem('user_id', user_id);
            localStorage.setItem('token', token);

          }).catch(registerErr => console.log(registerErr));

      };

      // Login the user and get the token.
      const login = (email, password) => {

        const user = { email, password };

        axios.post('http://localhost:4000/users/login/email', user)
          .then(async loginRes => {

            const { user_id, token } = loginRes.data;
            
            // Store token and user id in local storage.
            localStorage.setItem('user_id', user_id);
            localStorage.setItem('token', token);

          }).catch(registerErr => console.log(registerErr));

      };

      window.addEventListener('load', () => {
        // console.log(register('Brandon', 'brandon@mail.com', 'TestPass12!@'));
        login('brandon@mail.com', 'TestPass12!@');
      });





      const mediaUploadInput = document.querySelector('#media-upload-input');
      const submitButton     = document.querySelector('#upload-form-submit-button');
      const uploadForm       = document.querySelector('#upload-form');

      const user_id = 0;

      const handleSubmit = (e) => {
        e.preventDefault();

        const user_id = JSON.stringify(localStorage.getItem('user_id'));
        const token   = JSON.stringify(localStorage.getItem('token'));

        console.log(user_id, token);

        uploadForm.action = `http://localhost:4000/users/${ user_id }/media/add`;

      };

      uploadForm.addEventListener('click', e => handleSubmit(e));

    </script>
  </body>
</html>